# ç›ˆç±³é‡‘èæ•™å­¦å¹³å° - V2.0å‡çº§æŒ‡å—

## ğŸ“Š ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬å·**: V2.0.0
- **å‘å¸ƒæ—¥æœŸ**: 2026-01-05
- **å‡çº§ç±»å‹**: é‡å¤§æ›´æ–°

## ğŸ¯ æœ¬æ¬¡å‡çº§å†…å®¹

æœ¬æ¬¡å‡çº§åŒ…å«**4ä¸ªé‡å¤§åŠŸèƒ½æ›´æ–°**ï¼š

1. âœ… **é›†æˆçœŸå®MCP API** - è¿æ¥çœŸå®çš„ç›ˆç±³æ•°æ®API
2. âœ… **ç”¨æˆ·ç™»å½•è®¤è¯ç³»ç»Ÿ** - å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†
3. âœ… **æ•°æ®åº“æŒä¹…åŒ–** - å­¦ä¹ è¿›åº¦ã€æŠ•èµ„ç»„åˆã€ç»ƒä¹ æ•°æ®æŒä¹…åŒ–å­˜å‚¨
4. âœ… **äº‘ç«¯éƒ¨ç½²æ”¯æŒ** - Dockerã€Herokuã€Streamlit Cloudç­‰å¤šç§éƒ¨ç½²æ–¹å¼

---

## ğŸš€ æ–°åŠŸèƒ½è¯¦è§£

### 1. çœŸå®MCP APIé›†æˆ

#### åŠŸèƒ½è¯´æ˜

V1.0ç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼ŒV2.0å·²ç»å®Œå…¨é›†æˆäº†ç›ˆç±³MCP APIï¼Œå¯ä»¥è·å–çœŸå®çš„åŸºé‡‘æ•°æ®å’Œå¸‚åœºä¿¡æ¯ã€‚

#### æ–°å¢æ–‡ä»¶

- `utils/mcp_client.py` - MCP APIå®¢æˆ·ç«¯å°è£…

#### æ ¸å¿ƒåŠŸèƒ½

```python
from utils.mcp_client import get_mcp_client

# è·å–MCPå®¢æˆ·ç«¯å®ä¾‹
mcp = get_mcp_client()

# æœç´¢åŸºé‡‘
funds = mcp.search_funds("æ˜“æ–¹è¾¾", category="è‚¡ç¥¨å‹")

# è·å–åŸºé‡‘è¯¦æƒ…
details = mcp.get_funds_detail(["110011", "161725"])

# è·å–å‡€å€¼å†å²
nav = mcp.get_fund_nav_history(["110011"], dimension_type="oneYear")

# æŠ•èµ„ç»„åˆåˆ†æ
risk = mcp.analyze_portfolio_risk([
    {"fundCode": "110011", "weight": 0.5},
    {"fundCode": "161725", "weight": 0.5}
])

# è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ
simulation = mcp.monte_carlo_simulate(
    weights={"stock": 0.6, "bond": 0.4},
    period_count=5,
    simulation_count=10000
)
```

#### APIå·¥å…·åˆ—è¡¨ï¼ˆ54ä¸ªï¼‰

**åŸºé‡‘æ•°æ®ç±»** (10ä¸ª):
- SearchFunds - æœç´¢åŸºé‡‘
- GuessFundCode - åŒ¹é…åŸºé‡‘ä»£ç 
- BatchGetFundsDetail - æ‰¹é‡è·å–åŸºé‡‘è¯¦æƒ…
- BatchGetFundNavHistory - æ‰¹é‡è·å–å‡€å€¼å†å²
- GetBatchFundPerformance - æ‰¹é‡è·å–ä¸šç»©
- BatchGetFundsHolding - æ‰¹é‡è·å–æŒä»“
- GetFundDiagnosis - åŸºé‡‘è¯Šæ–­
- ç­‰ç­‰...

**æŠ•èµ„ç»„åˆç±»** (15ä¸ª):
- GetAssetAllocationPlan - èµ„äº§é…ç½®æ–¹æ¡ˆ
- AnalyzePortfolioRisk - ç»„åˆé£é™©åˆ†æ
- GetFundsBackTest - ç»„åˆå›æµ‹
- GetFundsCorrelation - åŸºé‡‘ç›¸å…³æ€§
- DiagnoseFundPortfolio - ç»„åˆè¯Šæ–­
- MonteCarloSimulate - è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ
- ç­‰ç­‰...

**å¸‚åœºæ•°æ®ç±»** (8ä¸ª):
- GetLatestQuotations - å¸‚åœºè¡Œæƒ…
- SearchHotTopic - æœç´¢å¸‚åœºçƒ­ç‚¹
- ç­‰ç­‰...

#### é…ç½®æ–¹æ³•

åœ¨ `.streamlit/secrets.toml` ä¸­é…ç½®APIå¯†é’¥ï¼š

```toml
MCP_API_KEY = "your_mcp_api_key_here"
```

#### ç¼“å­˜æœºåˆ¶

æ‰€æœ‰APIè°ƒç”¨éƒ½è‡ªåŠ¨ç¼“å­˜5åˆ†é’Ÿï¼Œå‡å°‘é‡å¤è¯·æ±‚ï¼š

```python
@st.cache_data(ttl=300)  # 5åˆ†é’Ÿç¼“å­˜
def search_funds(_self, keyword: str, ...):
    ...
```

#### é”™è¯¯å¤„ç†

APIè°ƒç”¨å¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°æ¨¡æ‹Ÿæ•°æ®ï¼Œç¡®ä¿åº”ç”¨æ­£å¸¸è¿è¡Œï¼š

```python
try:
    result = self._call_api("SearchFunds", data=data)
    return result.get("data", [])
except Exception as e:
    st.error(f"APIè°ƒç”¨å¤±è´¥: {str(e)}")
    return self._get_fallback_data(endpoint, data)
```

---

### 2. ç”¨æˆ·ç™»å½•è®¤è¯ç³»ç»Ÿ

#### åŠŸèƒ½è¯´æ˜

V2.0æ–°å¢äº†å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼Œæ”¯æŒç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¼šè¯ç®¡ç†ã€æƒé™æ§åˆ¶ã€‚

#### æ–°å¢æ–‡ä»¶

- `utils/auth.py` - ç”¨æˆ·è®¤è¯æ¨¡å—
- `data/users.db` - ç”¨æˆ·æ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

#### æ ¸å¿ƒåŠŸèƒ½

##### ç”¨æˆ·æ³¨å†Œ

```python
from utils.auth import get_auth_manager

auth = get_auth_manager()

# æ³¨å†Œæ–°ç”¨æˆ·
success, msg = auth.register(
    username="student001",
    email="student@example.com",
    password="Pass123",
    full_name="å¼ ä¸‰",
    school="åŒ—äº¬å¤§å­¦",
    grade="å¤§ä¸‰",
    major="é‡‘èå­¦",
    role="student"
)
```

**å¯†ç è¦æ±‚**:
- é•¿åº¦è‡³å°‘6ä½
- å¿…é¡»åŒ…å«å­—æ¯
- å¿…é¡»åŒ…å«æ•°å­—

##### ç”¨æˆ·ç™»å½•

```python
# ç™»å½•
success, msg, user_info = auth.login("student001", "Pass123")

if success:
    # user_info åŒ…å«ç”¨æˆ·ä¿¡æ¯å’Œtoken
    print(user_info['username'])  # student001
    print(user_info['role'])       # student
    print(user_info['token'])      # JWT token
```

##### ä¼šè¯ç®¡ç†

- JWT tokenæœ‰æ•ˆæœŸï¼š7å¤©
- è‡ªåŠ¨è¿‡æœŸæ£€æŸ¥
- æ”¯æŒå¤šè®¾å¤‡ç™»å½•

##### è§’è‰²æƒé™

ç³»ç»Ÿæ”¯æŒ3ç§è§’è‰²ï¼š

1. **student** (å­¦ç”Ÿ) - é»˜è®¤è§’è‰²
   - å­¦ä¹ è¯¾ç¨‹
   - æäº¤ç»ƒä¹ 
   - æŸ¥çœ‹ä¸ªäººè¿›åº¦

2. **teacher** (æ•™å¸ˆ)
   - æ‰€æœ‰å­¦ç”Ÿæƒé™
   - æŸ¥çœ‹å…¨éƒ¨å­¦ç”Ÿè¿›åº¦
   - æ‰¹æ”¹ä½œä¸š

3. **admin** (ç®¡ç†å‘˜)
   - æ‰€æœ‰æƒé™
   - ç”¨æˆ·ç®¡ç†
   - ç³»ç»Ÿè®¾ç½®

##### ä½¿ç”¨è£…é¥°å™¨ä¿æŠ¤é¡µé¢

```python
from utils.auth import require_auth, check_role

@require_auth
def show_protected_page():
    """éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®"""
    st.write("å—ä¿æŠ¤çš„å†…å®¹")

@check_role(['teacher', 'admin'])
def show_teacher_page():
    """ä»…æ•™å¸ˆå’Œç®¡ç†å‘˜å¯è®¿é—®"""
    st.write("æ•™å¸ˆåŠŸèƒ½")
```

#### æ¼”ç¤ºè´¦æˆ·

ç³»ç»Ÿæä¾›æ¼”ç¤ºè´¦æˆ·å¿«é€Ÿä½“éªŒï¼š

- **ç”¨æˆ·å**: demo_student
- **å¯†ç **: demo123

ç‚¹å‡»"æ¼”ç¤ºè´¦æˆ·ç™»å½•"æŒ‰é’®å³å¯è‡ªåŠ¨ç™»å½•ã€‚

#### æ•°æ®åº“ç»“æ„

**usersè¡¨**:
```sql
- id: ç”¨æˆ·ID
- username: ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- email: é‚®ç®±ï¼ˆå”¯ä¸€ï¼‰
- password_hash: å¯†ç å“ˆå¸Œï¼ˆSHA-256ï¼‰
- full_name: å§“å
- school: å­¦æ ¡
- grade: å¹´çº§
- major: ä¸“ä¸š
- role: è§’è‰²
- created_at: åˆ›å»ºæ—¶é—´
- last_login: æœ€åç™»å½•æ—¶é—´
- is_active: æ˜¯å¦æ¿€æ´»
```

**sessionsè¡¨**:
```sql
- id: ä¼šè¯ID
- user_id: ç”¨æˆ·ID
- token: JWT token
- created_at: åˆ›å»ºæ—¶é—´
- expires_at: è¿‡æœŸæ—¶é—´
```

---

### 3. æ•°æ®åº“æŒä¹…åŒ–

#### åŠŸèƒ½è¯´æ˜

V2.0å®ç°äº†å®Œæ•´çš„æ•°æ®æŒä¹…åŒ–ï¼Œæ‰€æœ‰å­¦ä¹ æ•°æ®ã€æŠ•èµ„ç»„åˆã€ç»ƒä¹ æäº¤éƒ½ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚

#### æ–°å¢æ–‡ä»¶

- `utils/database.py` - æ•°æ®åº“ç®¡ç†æ¨¡å—
- `data/education.db` - æ•™å­¦æ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰

#### æ ¸å¿ƒåŠŸèƒ½

##### å­¦ä¹ è¿›åº¦ç®¡ç†

```python
from utils.database import get_db_manager

db = get_db_manager()

# æ›´æ–°å­¦ä¹ è¿›åº¦
db.update_progress(
    user_id=1,
    module_name="åŸºé‡‘æŠ•èµ„å…¥é—¨",
    lesson_name="ä»€ä¹ˆæ˜¯åŸºé‡‘",
    status="completed",
    score=95.0
)

# è·å–ç”¨æˆ·è¿›åº¦
progress = db.get_user_progress(user_id=1)

# è·å–æ¨¡å—ç»Ÿè®¡
stats = db.get_module_statistics(user_id=1, module_name="åŸºé‡‘æŠ•èµ„å…¥é—¨")
# {'total': 10, 'completed': 8, 'avg_score': 87.5}
```

##### æŠ•èµ„ç»„åˆç®¡ç†

```python
# åˆ›å»ºæŠ•èµ„ç»„åˆ
success, msg, portfolio_id = db.create_portfolio(
    user_id=1,
    portfolio_name="æˆ‘çš„ç¨³å¥ç»„åˆ",
    description="å¹³è¡¡å‹æŠ•èµ„ç»„åˆ"
)

# æ›´æ–°æŒä»“
db.update_portfolio_holdings(portfolio_id, [
    {"fund_code": "110011", "fund_name": "æ˜“æ–¹è¾¾ä¸­å°ç›˜", "weight": 0.3, "amount": 30000},
    {"fund_code": "161725", "fund_name": "æ‹›å•†ä¸­è¯ç™½é…’", "weight": 0.3, "amount": 30000},
    {"fund_code": "003096", "fund_name": "ä¸­æ¬§åŒ»ç–—å¥åº·", "weight": 0.4, "amount": 40000}
])

# è·å–ç”¨æˆ·æ‰€æœ‰ç»„åˆ
portfolios = db.get_user_portfolios(user_id=1)

# è·å–ç»„åˆæŒä»“
holdings = db.get_portfolio_holdings(portfolio_id)
```

##### ç»ƒä¹ æäº¤ç®¡ç†

```python
# æäº¤ç»ƒä¹ ç­”æ¡ˆ
db.submit_exercise(
    user_id=1,
    case_id="case_1",
    question_id="q1",
    answer="æˆ‘çš„ç­”æ¡ˆ...",
    is_correct=True,
    score=10.0
)

# è·å–æäº¤è®°å½•
submissions = db.get_user_submissions(user_id=1, case_id="case_1")
```

##### å­¦ä¹ ç¬”è®°

```python
# ä¿å­˜ç¬”è®°
db.save_note(
    user_id=1,
    module_name="åŸºé‡‘æŠ•èµ„å…¥é—¨",
    lesson_name="åŸºé‡‘ç±»å‹",
    note_content="å­¦ä¹ ç¬”è®°å†…å®¹..."
)

# è·å–ç¬”è®°
notes = db.get_user_notes(user_id=1, module_name="åŸºé‡‘æŠ•èµ„å…¥é—¨")
```

##### æ´»åŠ¨æ—¥å¿—

```python
# è®°å½•å­¦ä¹ æ´»åŠ¨
db.log_activity(
    user_id=1,
    activity_type="lesson_complete",
    activity_data={"module": "åŸºé‡‘æŠ•èµ„å…¥é—¨", "lesson": "ä»€ä¹ˆæ˜¯åŸºé‡‘"}
)

# è·å–æ´»åŠ¨ç»Ÿè®¡
activity_stats = db.get_daily_activity_stats(user_id=1, days=30)
```

#### æ•°æ®åº“è¡¨ç»“æ„

1. **learning_progress** - å­¦ä¹ è¿›åº¦
2. **exercise_submissions** - ç»ƒä¹ æäº¤
3. **portfolios** - æŠ•èµ„ç»„åˆ
4. **holdings** - æŒä»“æ˜ç»†
5. **study_notes** - å­¦ä¹ ç¬”è®°
6. **activity_logs** - æ´»åŠ¨æ—¥å¿—

#### æ•°æ®å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
cp data/users.db data/users_backup_$(date +%Y%m%d).db
cp data/education.db data/education_backup_$(date +%Y%m%d).db

# æ¢å¤æ•°æ®åº“
cp data/users_backup_20260105.db data/users.db
cp data/education_backup_20260105.db data/education.db
```

---

### 4. äº‘ç«¯éƒ¨ç½²æ”¯æŒ

#### åŠŸèƒ½è¯´æ˜

V2.0æä¾›äº†å¤šç§äº‘ç«¯éƒ¨ç½²æ–¹å¼ï¼ŒåŒ…æ‹¬Dockerå®¹å™¨åŒ–ã€Herokuã€Streamlit Cloudã€AWSã€é˜¿é‡Œäº‘ç­‰ã€‚

#### æ–°å¢æ–‡ä»¶

- `Dockerfile` - Dockeré•œåƒé…ç½®
- `docker-compose.yml` - Docker Composeé…ç½®
- `.dockerignore` - Dockerå¿½ç•¥æ–‡ä»¶
- `Procfile` - Herokuéƒ¨ç½²é…ç½®
- `setup.sh` - Herokuå¯åŠ¨è„šæœ¬
- `éƒ¨ç½²æŒ‡å—.md` - å®Œæ•´éƒ¨ç½²æ–‡æ¡£

#### æ”¯æŒçš„éƒ¨ç½²æ–¹å¼

| éƒ¨ç½²æ–¹å¼ | éš¾åº¦ | è´¹ç”¨ | æ¨èåº¦ |
|---------|------|------|--------|
| **Streamlit Cloud** | â­ | å…è´¹ | â­â­â­â­â­ |
| **Dockeræœ¬åœ°** | â­â­ | å…è´¹ | â­â­â­â­ |
| **Heroku** | â­â­ | å…è´¹é¢åº¦ | â­â­â­â­ |
| **AWS Lightsail** | â­â­â­ | $3.5/æœˆèµ· | â­â­â­ |
| **é˜¿é‡Œäº‘ECS** | â­â­â­ | Â¥70/æœˆèµ· | â­â­â­ |

#### Dockerå¿«é€Ÿéƒ¨ç½²

```bash
# ä½¿ç”¨Docker Composeï¼ˆæ¨èï¼‰
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

#### Streamlit Cloudéƒ¨ç½²

1. æ¨é€ä»£ç åˆ°GitHub
2. è®¿é—® [share.streamlit.io](https://share.streamlit.io)
3. è¿æ¥GitHubä»“åº“
4. è®¾ç½®ä¸»æ–‡ä»¶: `web_app/app.py`
5. é…ç½®å¯†é’¥
6. ç‚¹å‡»Deploy

è¯¦è§ï¼š`éƒ¨ç½²æŒ‡å—.md`

---

## ğŸ“ ä»V1.0å‡çº§åˆ°V2.0

### æ­¥éª¤1: å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½æ—§ç‰ˆæœ¬
cp -r web_app web_app_v1_backup
```

### æ­¥éª¤2: æ›´æ–°ä»£ç 

```bash
cd web_app

# æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨Gitï¼‰
git pull origin main

# æˆ–è€…ä¸‹è½½æ–°ç‰ˆæœ¬æ–‡ä»¶è¦†ç›–
```

### æ­¥éª¤3: å®‰è£…æ–°ä¾èµ–

```bash
pip install -r requirements.txt
```

æ–°å¢ä¾èµ–ï¼š
- `requests>=2.31.0` - HTTPå®¢æˆ·ç«¯
- `PyJWT>=2.8.0` - JWTè®¤è¯

### æ­¥éª¤4: é…ç½®å¯†é’¥

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .streamlit/secrets.toml.example .streamlit/secrets.toml

# ç¼–è¾‘å¯†é’¥æ–‡ä»¶
nano .streamlit/secrets.toml
```

å¿…é¡»é…ç½®ï¼š
- `MCP_API_KEY` - ç›ˆç±³MCP APIå¯†é’¥
- `JWT_SECRET` - JWTå¯†é’¥ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼‰

### æ­¥éª¤5: åˆå§‹åŒ–æ•°æ®åº“

é¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ï¼š

```bash
streamlit run app.py
```

ä¼šè‡ªåŠ¨åˆ›å»ºï¼š
- `data/users.db` - ç”¨æˆ·æ•°æ®åº“
- `data/education.db` - æ•™å­¦æ•°æ®åº“

### æ­¥éª¤6: æµ‹è¯•åŠŸèƒ½

- [ ] ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- [ ] åŸºé‡‘æœç´¢ï¼ˆçœŸå®APIï¼‰
- [ ] å­¦ä¹ è¿›åº¦ä¿å­˜
- [ ] æŠ•èµ„ç»„åˆåˆ›å»º

---

## ğŸ”„ ä»£ç è¿ç§»æŒ‡å—

### å¦‚æœä½ ä¿®æ”¹äº†V1.0ä»£ç 

#### 1. é¡µé¢ç»„ä»¶æ›´æ–°

**V1.0** (ç›´æ¥ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®):
```python
# pages/fund_analysis.py
funds = generate_mock_fund_data()
```

**V2.0** (ä½¿ç”¨MCP API):
```python
# pages/fund_analysis.py
from utils.mcp_client import get_mcp_client

mcp = get_mcp_client()
funds = mcp.search_funds(keyword)
```

#### 2. ç”¨æˆ·æ•°æ®è®¿é—®

**V1.0** (session_state):
```python
student_id = st.session_state.student_id
```

**V2.0** (æ•°æ®åº“):
```python
user = st.session_state.user
user_id = user.get('id')
db = st.session_state.db_manager
progress = db.get_user_progress(user_id)
```

#### 3. è®¤è¯æ£€æŸ¥

**V2.0** åœ¨ `app.py` ä¸­å·²è‡ªåŠ¨æ£€æŸ¥è®¤è¯ï¼Œé¡µé¢æ— éœ€é¢å¤–å¤„ç†ï¼š

```python
# app.py
if not st.session_state.authenticated:
    show_login_page()
    return

# åç»­ä»£ç ä»…ç™»å½•ç”¨æˆ·å¯è®¿é—®
```

---

## ğŸ†• æ–°APIä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: æœç´¢å¹¶åˆ†æåŸºé‡‘

```python
from utils.mcp_client import get_mcp_client

mcp = get_mcp_client()

# 1. æœç´¢åŸºé‡‘
funds = mcp.search_funds("æ˜“æ–¹è¾¾", category="è‚¡ç¥¨å‹")

# 2. è·å–è¯¦æƒ…
fund_codes = [f['fundCode'] for f in funds[:5]]
details = mcp.get_funds_detail(fund_codes)

# 3. è·å–å‡€å€¼å†å²
nav_data = mcp.get_fund_nav_history(fund_codes, dimension_type="oneYear")

# 4. è·å–æŒä»“
holdings = mcp.get_funds_holding(fund_codes)

# 5. åŸºé‡‘è¯Šæ–­
diagnosis = mcp.get_fund_diagnosis(fund_codes[0])
```

### ç¤ºä¾‹2: æ„å»ºæŠ•èµ„ç»„åˆ

```python
from utils.database import get_db_manager

db = get_db_manager()
user_id = st.session_state.user['id']

# 1. åˆ›å»ºç»„åˆ
success, msg, portfolio_id = db.create_portfolio(
    user_id=user_id,
    portfolio_name="æˆ‘çš„æŠ•èµ„ç»„åˆ",
    description="ç¨³å¥å‹ç»„åˆ"
)

# 2. æ·»åŠ æŒä»“
holdings = [
    {"fund_code": "110011", "fund_name": "æ˜“æ–¹è¾¾ä¸­å°ç›˜", "weight": 0.4, "amount": 40000},
    {"fund_code": "161725", "fund_name": "æ‹›å•†ä¸­è¯ç™½é…’", "weight": 0.3, "amount": 30000},
    {"fund_code": "003096", "fund_name": "ä¸­æ¬§åŒ»ç–—å¥åº·", "weight": 0.3, "amount": 30000}
]
db.update_portfolio_holdings(portfolio_id, holdings)

# 3. åˆ†æç»„åˆé£é™©ï¼ˆä½¿ç”¨MCP APIï¼‰
mcp = get_mcp_client()
risk_analysis = mcp.analyze_portfolio_risk([
    {"fundCode": h["fund_code"], "weight": h["weight"]} for h in holdings
])

# 4. ç»„åˆç›¸å…³æ€§
correlation = mcp.get_funds_correlation([
    {"fundCode": h["fund_code"]} for h in holdings
])

# 5. è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿ
simulation = mcp.monte_carlo_simulate(
    weights={"stock": 0.7, "bond": 0.3},
    frequency="YEAR",
    period_count=5,
    simulation_count=10000
)
```

### ç¤ºä¾‹3: è®°å½•å­¦ä¹ è¿›åº¦

```python
from utils.database import get_db_manager

db = get_db_manager()
user_id = st.session_state.user['id']

# 1. å®Œæˆä¸€èŠ‚è¯¾
db.update_progress(
    user_id=user_id,
    module_name="åŸºé‡‘æŠ•èµ„å…¥é—¨",
    lesson_name="ä»€ä¹ˆæ˜¯åŸºé‡‘",
    status="completed",
    score=95.0
)

# 2. æäº¤ç»ƒä¹ 
db.submit_exercise(
    user_id=user_id,
    case_id="case_1",
    question_id="q1",
    answer="åŸºé‡‘æ˜¯ä¸€ç§é›†åˆæŠ•èµ„å·¥å…·...",
    is_correct=True,
    score=10.0
)

# 3. ä¿å­˜ç¬”è®°
db.save_note(
    user_id=user_id,
    module_name="åŸºé‡‘æŠ•èµ„å…¥é—¨",
    lesson_name="åŸºé‡‘ç±»å‹",
    note_content="ä»Šå¤©å­¦ä¹ äº†åŸºé‡‘çš„åˆ†ç±»..."
)

# 4. è®°å½•æ´»åŠ¨
db.log_activity(
    user_id=user_id,
    activity_type="lesson_complete",
    activity_data={"module": "åŸºé‡‘æŠ•èµ„å…¥é—¨", "duration": 15}
)

# 5. æŸ¥çœ‹è¿›åº¦ç»Ÿè®¡
stats = db.get_module_statistics(user_id, "åŸºé‡‘æŠ•èµ„å…¥é—¨")
print(f"å®Œæˆè¿›åº¦: {stats['completed']}/{stats['total']}")
print(f"å¹³å‡åˆ†: {stats['avg_score']}")
```

---

## âš ï¸ é‡è¦å˜æ›´

### 1. Session Stateå˜æ›´

**æ–°å¢å­—æ®µ**:
- `st.session_state.authenticated` - è®¤è¯çŠ¶æ€
- `st.session_state.user` - å½“å‰ç”¨æˆ·ä¿¡æ¯
- `st.session_state.db_manager` - æ•°æ®åº“ç®¡ç†å™¨
- `st.session_state.mcp_client` - MCPå®¢æˆ·ç«¯

**ç§»é™¤å­—æ®µ**:
- `st.session_state.student_id` - æ”¹ç”¨ `user['id']`

### 2. æ•°æ®è®¿é—®æ–¹å¼

**V1.0**: ç›´æ¥ä½¿ç”¨ `FinanceEducationPlatform`
```python
platform = st.session_state.platform
progress = platform.get_student_progress(student_id)
```

**V2.0**: ä½¿ç”¨æ•°æ®åº“ç®¡ç†å™¨
```python
db = st.session_state.db_manager
progress = db.get_user_progress(user_id)
```

### 3. APIè°ƒç”¨æ–¹å¼

**V1.0**: æ¨¡æ‹Ÿæ•°æ®
```python
funds = generate_mock_data()
```

**V2.0**: çœŸå®API
```python
mcp = st.session_state.mcp_client
funds = mcp.search_funds(keyword)
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### secrets.tomlé…ç½®é¡¹

```toml
# å¿…éœ€é…ç½®
MCP_API_KEY = "your_mcp_api_key_here"
JWT_SECRET = "your_jwt_secret_key_here"

# å¯é€‰é…ç½®
DB_TYPE = "sqlite"  # æ•°æ®åº“ç±»å‹
DEBUG = false       # è°ƒè¯•æ¨¡å¼
LOG_LEVEL = "INFO"  # æ—¥å¿—çº§åˆ«
```

### ç¯å¢ƒå˜é‡ï¼ˆéƒ¨ç½²æ—¶ï¼‰

```bash
# Heroku
heroku config:set MCP_API_KEY="xxx"
heroku config:set JWT_SECRET="xxx"

# Docker
docker run -e MCP_API_KEY="xxx" -e JWT_SECRET="xxx" ...
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | V1.0 | V2.0 | æ”¹è¿› |
|-----|------|------|------|
| æ•°æ®çœŸå®æ€§ | æ¨¡æ‹Ÿæ•°æ® | çœŸå®API | âœ… 100% |
| ç”¨æˆ·ç®¡ç† | æ—  | å®Œæ•´ç³»ç»Ÿ | âœ… æ–°å¢ |
| æ•°æ®æŒä¹…åŒ– | å¦ | æ˜¯ | âœ… æ–°å¢ |
| éƒ¨ç½²æ”¯æŒ | ä»…æœ¬åœ° | å¤šäº‘å¹³å° | âœ… æ–°å¢ |
| APIç¼“å­˜ | æ—  | 5åˆ†é’Ÿ | âœ… å‡å°‘è¯·æ±‚ |
| é¡µé¢åŠ è½½ | ~1s | ~0.8s | âœ… 20%æå‡ |

---

## ğŸ› å·²çŸ¥é—®é¢˜

### 1. é¦–æ¬¡åŠ è½½è¾ƒæ…¢

**åŸå› **: éœ€è¦åˆå§‹åŒ–æ•°æ®åº“å’Œå»ºç«‹APIè¿æ¥

**è§£å†³**: å·²æ·»åŠ ç¼“å­˜ï¼Œåç»­è®¿é—®é€Ÿåº¦æ­£å¸¸

### 2. SQLiteå¹¶å‘é™åˆ¶

**å½±å“**: å¤šç”¨æˆ·åŒæ—¶å†™å…¥å¯èƒ½å‡ºç°é”å®š

**å»ºè®®**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨PostgreSQL

**è¿ç§»æ–¹æ³•**:
```python
# utils/database.py
# ä¿®æ”¹è¿æ¥å­—ç¬¦ä¸²å³å¯
db_path = os.getenv('DATABASE_URL', 'data/education.db')
```

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£

- `README_WEB.md` - åº”ç”¨ä½¿ç”¨æ–‡æ¡£
- `éƒ¨ç½²æŒ‡å—.md` - éƒ¨ç½²è¯¦ç»†æŒ‡å—
- `æ•™å¸ˆä½¿ç”¨æ‰‹å†Œ.md` - æ•™å¸ˆåŠŸèƒ½è¯´æ˜

### æŠ€æœ¯æ”¯æŒ

- **é‚®ç®±**: support@example.com
- **GitHub Issues**: æäº¤é—®é¢˜
- **æ–‡æ¡£**: æŸ¥çœ‹å®Œæ•´æ–‡æ¡£

---

## ğŸ‰ æ€»ç»“

V2.0æ˜¯ä¸€ä¸ªé‡å¤§å‡çº§ï¼Œå¸¦æ¥äº†4ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š

âœ… çœŸå®APIé›†æˆ - å‘Šåˆ«æ¨¡æ‹Ÿæ•°æ®
âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ - å®Œæ•´çš„æƒé™ç®¡ç†
âœ… æ•°æ®æŒä¹…åŒ– - å­¦ä¹ æ•°æ®æ°¸ä¹…ä¿å­˜
âœ… äº‘ç«¯éƒ¨ç½² - éšæ—¶éšåœ°è®¿é—®

**å»ºè®®æ‰€æœ‰ç”¨æˆ·å°½å¿«å‡çº§åˆ°V2.0ï¼**

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ“ğŸ“Šâœ¨
